---
title: Makefile Engineering Ruleset
description: Standardized makefile patterns for consistent project commands across platforms and languages.
priority: 140
alwaysApply: false
files:
  include:
    - "**/Makefile"
    - "**/makefile"
    - "**/GNUmakefile"
---

# Makefile Engineering Ruleset

**Goal:** Standardized makefile patterns that provide consistent, discoverable commands across all projects regardless of underlying technology.

## Core Principles

- **Consistency**: Common interface across all components regardless of underlying technology
- **Simplicity**: Hide platform-specific commands (npm, pip, etc.) behind standard targets
- **Discoverability**: Always include `make help` to show available commands
- **Platform Independence**: Works across different languages and toolchains

## Standard Structure

### Required Elements

Every Makefile MUST have:

1. **Default target** that shows help
2. **`.PHONY` declarations** before recipe names
3. **`help` recipe** that lists all available commands
4. **One-line comments** documenting each recipe

### Template

```make
default: help

.PHONY: help
help: # Show help for each of the Makefile recipes
	@grep -E '^[a-zA-Z0-9 -]+:.*#'  Makefile | sort | while read -r l; do printf "\033[1;32m$$(echo $$l | cut -f 1 -d':')\033[00m:$$(echo $$l | cut -f 2- -d'#')\n"; done

.PHONY: init
init: # Set up and validate the local development environment
	./scripts/init.sh

.PHONY: install
install: # Install all dependencies
	npm install  # or pip install -r requirements.txt, etc.

.PHONY: dev
dev: # Run in development mode (with live reload)
	npm run dev  # or python -m flask run, etc.

.PHONY: lint
lint: # Validate code formatting and linting
	npm run lint  # or ruff check, etc.

.PHONY: test
test: # Run tests
	npm test  # or pytest, etc.

.PHONY: build
build: # Build the project for distribution
	npm run build  # or go build, etc.

.PHONY: clean
clean: # Remove build artifacts and temporary files
	rm -rf dist/ node_modules/.cache/
```

## Standard Targets

These targets should be consistent across projects:

| Target | Purpose | Example |
|--------|---------|---------|
| `init` | Setup and validate local development environment | Install tools, check versions |
| `install` | Install all dependencies | `npm install`, `pip install -r requirements.txt` |
| `dev` | Run in development mode (live reload) | `npm run dev`, `python -m flask run` |
| `lint` | Validate formatting and linting | `npm run lint`, `ruff check` |
| `lint:fix` | Auto-fix linting issues | `npm run lint:fix`, `ruff check --fix` |
| `test` | Run unit tests | `npm test`, `pytest` |
| `test:watch` | Run tests in watch mode | `npm test:watch`, `pytest-watch` |
| `test:coverage` | Run tests with coverage | `npm test:coverage`, `pytest --cov` |
| `build` | Build for distribution | `npm run build`, `go build` |
| `clean` | Remove build artifacts | `rm -rf dist/ build/` |
| `format` | Format code | `prettier --write`, `black .` |

## Monorepo Patterns

### Service-Level Makefiles

Each service/module has its own makefile with service-specific commands:

```make
# ui/makefile
.PHONY: dev
dev: # Start UI in development mode
	npm run dev -- --port 3000
```

### Project-Level Makefile

Root makefile orchestrates all services:

```make
# Root makefile
.PHONY: dev
dev: # Start all services in development mode
	docker compose up

.PHONY: lint
lint: # Lint all services
	cd ui && make lint
	cd api && make lint
	cd infra && make lint
```

Or use Docker Compose:

```make
.PHONY: dev
dev: # Start all services
	docker compose up

.PHONY: lint
lint: # Lint all services
	docker compose run --rm ui make lint
	docker compose run --rm api make lint
```

## Best Practices

### Keep Recipes Small

Makefile recipes should be very small - a few commands only. Complex logic should be in scripts:

```make
#  GOOD: Simple recipe calling a script
.PHONY: init
init: # Setup development environment
	./scripts/init.sh

#  BAD: Complex logic in makefile
init:
	@if [ ! -f .env ]; then \
		cp .env.example .env; \
		echo "Created .env file"; \
	fi
	@npm install
	@pip install -r requirements.txt
	# ... many more lines
```

### No Colors in Makefiles

Makefiles are not shell scripts. Don't use color codes or fancy formatting:

```make
#  GOOD: Simple output
.PHONY: test
test: # Run tests
	pytest

#  BAD: Color codes and formatting
test:
	@echo "\033[1;32mRunning tests...\033[0m"
	pytest
	@echo "\033[1;32mTests passed!\033[0m"
```

### Platform-Aware Commands

When commands differ by platform, use conditional logic:

```make
UNAME_S := $(shell uname -s)
ifeq ($(UNAME_S),Linux)
    PLATFORM := linux
endif
ifeq ($(UNAME_S),Darwin)
    PLATFORM := darwin
endif

.PHONY: install-tools
install-tools: # Install platform-specific tools
	@if [ "$(PLATFORM)" = "darwin" ]; then \
		brew install jq; \
	else \
		apt-get install -y jq; \
	fi
```

### Environment Variables

Use environment variables for configuration:

```make
ENV ?= dev
REGION ?= us-east-1

.PHONY: deploy
deploy: # Deploy to environment
	terraform apply -var="environment=$(ENV)" -var="region=$(REGION)"
```

## CI/CD Integration

### GitHub Actions

```make
.PHONY: ci
ci: lint test build # Run all CI checks
	@echo "CI checks passed"

# In GitHub Actions
- name: Run CI
  run: make ci
```

### Local CI Testing

```make
.PHONY: ci-local
ci-local: # Run CI checks locally
	make lint
	make test
	make build
```

## Examples

### Python Project

```make
default: help

.PHONY: help
help: # Show help for each of the Makefile recipes
	@grep -E '^[a-zA-Z0-9 -]+:.*#'  Makefile | sort | while read -r l; do printf "\033[1;32m$$(echo $$l | cut -f 1 -d':')\033[00m:$$(echo $$l | cut -f 2- -d'#')\n"; done

.PHONY: init
init: # Setup development environment
	python3 -m venv .venv
	.venv/bin/pip install --upgrade pip
	.venv/bin/pip install -r requirements.txt

.PHONY: lint
lint: # Lint code
	.venv/bin/ruff check .
	.venv/bin/black --check .

.PHONY: lint:fix
lint:fix: # Fix linting issues
	.venv/bin/ruff check --fix .
	.venv/bin/black .

.PHONY: test
test: # Run tests
	.venv/bin/pytest

.PHONY: test:coverage
test:coverage: # Run tests with coverage
	.venv/bin/pytest --cov=src --cov-report=term-missing
```

### Node.js Project

```make
default: help

.PHONY: help
help: # Show help for each of the Makefile recipes
	@grep -E '^[a-zA-Z0-9 -]+:.*#'  Makefile | sort | while read -r l; do printf "\033[1;32m$$(echo $$l | cut -f 1 -d':')\033[00m:$$(echo $$l | cut -f 2- -d'#')\n"; done

.PHONY: init
init: # Setup development environment
	npm install

.PHONY: dev
dev: # Start development server
	npm run dev

.PHONY: lint
lint: # Lint code
	npm run lint

.PHONY: test
test: # Run tests
	npm test

.PHONY: build
build: # Build for production
	npm run build
```

### Go Project

```make
default: help

.PHONY: help
help: # Show help for each of the Makefile recipes
	@grep -E '^[a-zA-Z0-9 -]+:.*#'  Makefile | sort | while read -r l; do printf "\033[1;32m$$(echo $$l | cut -f 1 -d':')\033[00m:$$(echo $$l | cut -f 2- -d'#')\n"; done

.PHONY: init
init: # Setup development environment
	go mod download
	go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

.PHONY: lint
lint: # Lint code
	golangci-lint run

.PHONY: test
test: # Run tests
	go test ./...

.PHONY: build
build: # Build binary
	go build -o bin/app ./cmd/app
```

## Security Considerations

- Don't hardcode secrets in Makefiles
- Use environment variables for sensitive values
- Validate required environment variables before running commands
- Use `.env` files with `.env.example` templates

## Review Checklist

When reviewing Makefiles, check:

- [ ] Has `help` recipe that lists all commands
- [ ] Uses `.PHONY` declarations
- [ ] Recipes are small and call scripts for complex logic
- [ ] Standard targets are present (`init`, `dev`, `lint`, `test`, `build`)
- [ ] No hardcoded secrets or credentials
- [ ] Platform-aware if needed
- [ ] Consistent with project's language/framework conventions
---

